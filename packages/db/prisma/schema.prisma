generator client {
  provider = "prisma-client-js"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String        @id @default(cuid())
  name        String?
  email       String        @unique
  password    String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  Credentials Credentials[]
  Workflow    Workflow[]
}

model Triggers {
  id       String            @id @default(cuid())
  name     String
  typeID   String
  config   Json
  type     AvailableTriggers @relation(fields: [typeID], references: [id])
  Workflow Workflow?
}

model AvailableTriggers {
  id      String     @id @default(cuid())
  name    String
  type    String     @unique
  config  Json
  Trigger Triggers[]
}

model AvailableNodes {
  id     String  @id @default(cuid())
  name   String
  typeId String  @unique
  config Json
  Node   Nodes[]
}

model Nodes {
  id          String         @id @default(cuid())
  name        String
  typeId      String
  config      Json
  position    Int
  Credentials Credentials[]
  type        AvailableNodes @relation(fields: [typeId], references: [id])
  Workflow    Workflow?
}

model Credentials {
  id     String  @id
  userId String
  type   String
  config Json
  nodeId String?
  Nodes  Nodes?  @relation(fields: [nodeId], references: [id])
  User   User    @relation(fields: [userId], references: [id])
}

model Workflow {
  id          String         @id
  name        String
  createdAt   DateTime       @default(now())
  updateAt    DateTime       @default(now())
  description String
  status      WorkFlowStatus
  userId      String
  config      Json
  TriggerId   String         @unique
  NodeId      String         @unique
  Nodes       Nodes          @relation(fields: [NodeId], references: [id])
  Triggers    Triggers       @relation(fields: [TriggerId], references: [id])
  User        User           @relation(fields: [userId], references: [id])
  workflow    WorkflowExecution[]
}


model   WorkflowExecution {
  id            String  @id @default(uuid())
  workflowId    String
  workflows     Workflow @relation(fields: [workflowId] , references: [id])

}
enum WorkFlowStatus {
  Start
  Pending
  InProgress
  ReConnecting
  Failed
  Completed
}
